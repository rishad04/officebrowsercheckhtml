<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-bars text-blue-600 mr-3"></i>
                Menu Management System
            </h1>
            <p class="text-gray-600">Drag and drop to reorder menu items and organize your navigation</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Menu Builder -->
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-t-lg">
                    <h2 class="text-xl font-semibold flex items-center gap-2">
                        <i class="fas fa-edit"></i>
                        Menu Builder
                    </h2>
                </div>
                
                <div class="p-6">
                    <!-- Add New Menu Item -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-3">Add New Menu Item</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <input 
                                type="text" 
                                id="menuName" 
                                placeholder="Menu Name"
                                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                            <input 
                                type="text" 
                                id="menuUrl" 
                                placeholder="URL (e.g., /admin/users)"
                                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                            <select 
                                id="menuIcon" 
                                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                                <option value="fas fa-home">Home</option>
                                <option value="fas fa-users">Users</option>
                                <option value="fas fa-file-alt">Posts</option>
                                <option value="fas fa-chart-bar">Analytics</option>
                                <option value="fas fa-cogs">Settings</option>
                                <option value="fas fa-briefcase">HRM</option>
                                <option value="fas fa-shopping-cart">Orders</option>
                                <option value="fas fa-tags">Categories</option>
                            </select>
                            <button 
                                onclick="addMenuItem()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200"
                            >
                                <i class="fas fa-plus mr-1"></i> Add
                            </button>
                        </div>
                    </div>

                    <!-- Sortable Menu List -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-800">Menu Items</h3>
                            <span class="text-sm text-gray-500">Drag to reorder</span>
                        </div>
                        <div id="menuList" class="space-y-2">
                            <!-- Menu items will be inserted here -->
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-3">
                        <button 
                            onclick="saveMenuOrder()" 
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center gap-2"
                        >
                            <i class="fas fa-save"></i>
                            Save Order
                        </button>
                        <button 
                            onclick="resetMenu()" 
                            class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center gap-2"
                        >
                            <i class="fas fa-undo"></i>
                            Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- Live Preview -->
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-4 rounded-t-lg">
                    <h2 class="text-xl font-semibold flex items-center gap-2">
                        <i class="fas fa-eye"></i>
                        Live Preview
                    </h2>
                </div>
                
                <div class="p-6">
                    <div class="bg-gray-800 rounded-lg p-4 min-h-96">
                        <div class="text-white mb-4">
                            <h3 class="font-semibold text-lg mb-2">Admin Panel</h3>
                            <p class="text-gray-400 text-sm">Navigation Menu</p>
                        </div>
                        
                        <nav id="previewMenu" class="space-y-1">
                            <!-- Preview menu items will be inserted here -->
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Messages -->
        <div id="toast" class="fixed bottom-4 right-4 z-50 hidden">
            <div id="toastContent" class="text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3">
                <i id="toastIcon"></i>
                <span id="toastMessage"></span>
            </div>
        </div>
    </div>

    <script>
        let menuItems = [
            { id: 1, name: 'Dashboard', url: '/admin/dashboard', icon: 'fas fa-home', order: 1 },
            { id: 2, name: 'Users', url: '/admin/users', icon: 'fas fa-users', order: 2 },
            { id: 3, name: 'Posts', url: '/admin/posts', icon: 'fas fa-file-alt', order: 3 },
            { id: 4, name: 'Analytics', url: '/admin/analytics', icon: 'fas fa-chart-bar', order: 4 },
            { id: 5, name: 'Settings', url: '/admin/settings', icon: 'fas fa-cogs', order: 5 }
        ];

        let originalMenuItems = [];
        let draggedElement = null;
        let nextId = 6;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            originalMenuItems = JSON.parse(JSON.stringify(menuItems));
            renderMenuItems();
            renderPreview();
        });

        function renderMenuItems() {
            const menuList = document.getElementById('menuList');
            menuList.innerHTML = '';

            menuItems
                .sort((a, b) => a.order - b.order)
                .forEach(item => {
                    const menuItem = createMenuItemElement(item);
                    menuList.appendChild(menuItem);
                });
        }

        function createMenuItemElement(item) {
            const div = document.createElement('div');
            div.className = 'menu-item bg-gray-50 border border-gray-200 rounded-lg p-4 cursor-move hover:bg-gray-100 transition-colors duration-200';
            div.draggable = true;
            div.dataset.id = item.id;

            div.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center">
                            <i class="${item.icon}"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-800">${item.name}</div>
                            <div class="text-sm text-gray-500">${item.url}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded">Order: ${item.order}</span>
                        <button onclick="editMenuItem(${item.id})" class="text-blue-600 hover:text-blue-800 p-1">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteMenuItem(${item.id})" class="text-red-600 hover:text-red-800 p-1">
                            <i class="fas fa-trash"></i>
                        </button>
                        <div class="w-6 text-gray-400">
                            <i class="fas fa-grip-vertical"></i>
                        </div>
                    </div>
                </div>
            `;

            // Add drag and drop event listeners
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragover', handleDragOver);
            div.addEventListener('drop', handleDrop);
            div.addEventListener('dragend', handleDragEnd);

            return div;
        }

        function renderPreview() {
            const previewMenu = document.getElementById('previewMenu');
            previewMenu.innerHTML = '';

            menuItems
                .sort((a, b) => a.order - b.order)
                .forEach(item => {
                    const menuItem = document.createElement('a');
                    menuItem.href = '#';
                    menuItem.className = 'flex items-center gap-3 px-3 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors duration-200';
                    menuItem.innerHTML = `
                        <i class="${item.icon}"></i>
                        <span>${item.name}</span>
                    `;
                    previewMenu.appendChild(menuItem);
                });
        }

        // Drag and Drop Functions
        function handleDragStart(e) {
            draggedElement = this;
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            // Add visual feedback
            if (this !== draggedElement) {
                this.style.borderTop = '3px solid #3b82f6';
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            
            if (this !== draggedElement) {
                const draggedId = parseInt(draggedElement.dataset.id);
                const targetId = parseInt(this.dataset.id);
                
                reorderMenuItems(draggedId, targetId);
                renderMenuItems();
                renderPreview();
                showToast('Menu order updated', 'success');
            }
            
            // Reset border styles
            document.querySelectorAll('.menu-item').forEach(item => {
                item.style.borderTop = '';
            });
        }

        function handleDragEnd(e) {
            this.style.opacity = '';
            draggedElement = null;
            
            // Reset all border styles
            document.querySelectorAll('.menu-item').forEach(item => {
                item.style.borderTop = '';
            });
        }

        function reorderMenuItems(draggedId, targetId) {
            const draggedItem = menuItems.find(item => item.id === draggedId);
            const targetItem = menuItems.find(item => item.id === targetId);
            
            if (!draggedItem || !targetItem) return;
            
            const draggedOrder = draggedItem.order;
            const targetOrder = targetItem.order;
            
            if (draggedOrder < targetOrder) {
                // Moving down
                menuItems.forEach(item => {
                    if (item.order > draggedOrder && item.order <= targetOrder) {
                        item.order--;
                    }
                });
                draggedItem.order = targetOrder;
            } else {
                // Moving up
                menuItems.forEach(item => {
                    if (item.order >= targetOrder && item.order < draggedOrder) {
                        item.order++;
                    }
                });
                draggedItem.order = targetOrder;
            }
        }

        // Menu Management Functions
        function addMenuItem() {
            const name = document.getElementById('menuName').value;
            const url = document.getElementById('menuUrl').value;
            const icon = document.getElementById('menuIcon').value;

            if (!name || !url) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            const newItem = {
                id: nextId++,
                name: name,
                url: url,
                icon: icon,
                order: menuItems.length + 1
            };

            menuItems.push(newItem);
            renderMenuItems();
            renderPreview();

            // Clear form
            document.getElementById('menuName').value = '';
            document.getElementById('menuUrl').value = '';
            document.getElementById('menuIcon').selectedIndex = 0;

            showToast(`Menu item "${name}" added`, 'success');
        }

        function deleteMenuItem(id) {
            if (confirm('Are you sure you want to delete this menu item?')) {
                const itemIndex = menuItems.findIndex(item => item.id === id);
                if (itemIndex > -1) {
                    const deletedItem = menuItems[itemIndex];
                    menuItems.splice(itemIndex, 1);
                    
                    // Reorder remaining items
                    menuItems.forEach(item => {
                        if (item.order > deletedItem.order) {
                            item.order--;
                        }
                    });
                    
                    renderMenuItems();
                    renderPreview();
                    showToast(`Menu item "${deletedItem.name}" deleted`, 'success');
                }
            }
        }

        function editMenuItem(id) {
            const item = menuItems.find(item => item.id === id);
            if (!item) return;

            const newName = prompt('Enter new name:', item.name);
            if (newName && newName !== item.name) {
                item.name = newName;
                renderMenuItems();
                renderPreview();
                showToast(`Menu item updated`, 'success');
            }
        }

        function saveMenuOrder() {
            // Simulate saving to Laravel backend
            const menuData = menuItems
                .sort((a, b) => a.order - b.order)
                .map(item => ({
                    id: item.id,
                    name: item.name,
                    url: item.url,
                    icon: item.icon,
                    order: item.order
                }));

            // This is where you would send to Laravel:
            // fetch('/admin/menu/update-order', {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //         'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            //     },
            //     body: JSON.stringify({ menu_items: menuData })
            // })

            console.log('Menu data to save:', menuData);
            showToast('Menu order saved successfully!', 'success');
        }

        function resetMenu() {
            if (confirm('Reset menu to original state?')) {
                menuItems = JSON.parse(JSON.stringify(originalMenuItems));
                renderMenuItems();
                renderPreview();
                showToast('Menu reset to original state', 'success');
            }
        }

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastContent = document.getElementById('toastContent');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');

            // Set content
            toastMessage.textContent = message;
            
            // Set styling based on type
            if (type === 'success') {
                toastContent.className = 'bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3';
                toastIcon.className = 'fas fa-check-circle';
            } else {
                toastContent.className = 'bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3';
                toastIcon.className = 'fas fa-exclamation-circle';
            }

            // Show toast
            toast.classList.remove('hidden');
            
            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Prevent default drag behavior on document
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
        });
    </script>

    <style>
        .menu-item {
            transition: all 0.2s ease;
        }

        .menu-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .menu-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Smooth transitions */
        * {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</body>
</html>